# Claude Code StatusLine

ä¸€ä¸ªä¸º Claude Code CLI å®šåˆ¶çš„çŠ¶æ€æ æ˜¾ç¤ºå·¥å…·ï¼Œå®æ—¶æ˜¾ç¤ºæ¨¡å‹ä¿¡æ¯ã€token ä½¿ç”¨æƒ…å†µå’Œè´¹ç”¨ç»Ÿè®¡ã€‚

![demo](demo.png)

## åŠŸèƒ½ç‰¹æ€§

- ğŸ¤– **æ¨¡å‹ä¿¡æ¯æ˜¾ç¤º**: æ˜¾ç¤ºå½“å‰ä½¿ç”¨çš„ Claude æ¨¡å‹
- ğŸ“Š **Token ä½¿ç”¨ç›‘æ§**: æ˜¾ç¤ºå½“å‰ä¼šè¯çš„ context token ä½¿ç”¨æƒ…å†µ(åŸºäº 160k é™åˆ¶, ccä¼šåœ¨80%å³160k contextçš„æ—¶å€™å¼€å§‹compact)
- ğŸ’° **è´¹ç”¨ç»Ÿè®¡**: åŸºäºccusageæ˜¾ç¤ºå½“æ—¥/å½“æœˆçš„ API ä½¿ç”¨è´¹ç”¨
- ğŸ¨ **å½©è‰²è¾“å‡º**: ä½¿ç”¨ä¸åŒé¢œè‰²åŒºåˆ†å„ç±»ä¿¡æ¯
- ğŸ“ˆ **è¿›åº¦æ¡æ˜¾ç¤º**: ç›´è§‚æ˜¾ç¤º token ä½¿ç”¨ç™¾åˆ†æ¯”

## å‰ç½®æ¡ä»¶

å®‰è£… ccusage å·¥å…·ç”¨äºè´¹ç”¨ç»Ÿè®¡ï¼š

```bash
npm install -g ccusage
```

## å®‰è£…é…ç½®

### 1. å¤åˆ¶è„šæœ¬æ–‡ä»¶

å°†æœ¬é¡¹ç›®ä¸­çš„è„šæœ¬æ–‡ä»¶å¤åˆ¶åˆ° `~/.claude/` ç›®å½•ä¸‹ï¼š

```bash
cp status-line.sh ~/.claude/
cp get-session-tokens.sh ~/.claude/
cp get-cost.sh ~/.claude/
chmod +x ~/.claude/*.sh
```

### 2. é…ç½® Claude Code

åœ¨ä½ çš„ Claude Code é…ç½®æ–‡ä»¶ä¸­æ·»åŠ  statusLine é…ç½®ï¼š

```json
{
  "$schema": "https://json.schemastore.org/claude-code-settings.json",
  "model": "xxx",
  "statusLine": {
    "type": "command",
    "command": "~/.claude/status-line.sh"
  }
}
```

## ä½¿ç”¨æ–¹æ³•

é…ç½®å®Œæˆåï¼Œå¯åŠ¨ Claude Code CLI å³å¯åœ¨çŠ¶æ€æ çœ‹åˆ°å®æ—¶ä¿¡æ¯ï¼š

```bash
claude
```

çŠ¶æ€æ æ ¼å¼ä¸ºï¼š
```
<æ¨¡å‹åç§°>  <tokenä½¿ç”¨è¿›åº¦æ¡> <ä½¿ç”¨ç™¾åˆ†æ¯”>%  <å½“æ—¥è´¹ç”¨>/<å½“æœˆè´¹ç”¨>
```

ç¤ºä¾‹è¾“å‡ºï¼š
```
Sonnet 4  â– â– â– â–¡â–¡â–¡â–¡â–¡â–¡â–¡ 32%  5/128
```

## è„šæœ¬è¯´æ˜

### status-line.sh
ä¸»çŠ¶æ€æ è„šæœ¬ï¼Œè´Ÿè´£æ•´åˆå„é¡¹ä¿¡æ¯å¹¶æ ¼å¼åŒ–è¾“å‡ºã€‚

### get-session-tokens.sh
åˆ†æå½“å‰ä¼šè¯çš„ transcript æ–‡ä»¶ï¼Œè®¡ç®— context token ä½¿ç”¨é‡ï¼š
- æ”¯æŒ JSONL æ ¼å¼çš„ transcript æ–‡ä»¶
- åŸºäº 160k token é™åˆ¶è®¡ç®—ä½¿ç”¨ç™¾åˆ†æ¯”
- æ˜¾ç¤ºè¿›åº¦æ¡å’Œç™¾åˆ†æ¯”

### get-cost.sh
è·å– API ä½¿ç”¨è´¹ç”¨ç»Ÿè®¡ï¼š
- ä¾èµ– `ccusage` å·¥å…·
- æ˜¾ç¤ºå½“æ—¥è´¹ç”¨/å½“æœˆæ€»è´¹ç”¨
- å¦‚æœå·¥å…·ä¸å¯ç”¨åˆ™æ˜¾ç¤º "N/A"

## è°ƒè¯•

å¦‚éœ€è°ƒè¯• token è®¡ç®—ï¼Œå¯è®¾ç½®ç¯å¢ƒå˜é‡ï¼š

```bash
DEBUG_TOKENS=1 ~/.claude/get-session-tokens.sh < input.json
```

## è‡ªå®šä¹‰

ä½ å¯ä»¥æ ¹æ®éœ€è¦ä¿®æ”¹è„šæœ¬ä¸­çš„ï¼š
- é¢œè‰²é…ç½®ï¼ˆstatus-line.sh:22ï¼‰
- Token é™åˆ¶é˜ˆå€¼ï¼ˆget-session-tokens.sh:42ï¼‰
- è¿›åº¦æ¡æ ·å¼ï¼ˆget-session-tokens.sh:28-36ï¼‰

## æ•…éšœæ’é™¤

1. **çŠ¶æ€æ ä¸æ˜¾ç¤º**: æ£€æŸ¥è„šæœ¬æ–‡ä»¶æ˜¯å¦æœ‰æ‰§è¡Œæƒé™
2. **Token æ˜¾ç¤º N/A**: æ£€æŸ¥ transcript æ–‡ä»¶è·¯å¾„æ˜¯å¦æ­£ç¡®
3. **è´¹ç”¨æ˜¾ç¤º N/A**: æ£€æŸ¥æ˜¯å¦å®‰è£…äº† `ccusage` å·¥å…·

## å…¼å®¹æ€§

- æ”¯æŒ macOS å’Œ Linux
- éœ€è¦ `jq` å’Œ `bc` å‘½ä»¤
- Claude Code CLI v0.8+